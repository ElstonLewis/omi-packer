{
    "provisioners": [
        {
            "type": "file",
            "source": "./files/",
            "destination": "/tmp/"
        },
        {
            "type": "shell",
            "execute_command": "chmod +x {{.Path}}; {{.Vars}} sudo -E -S bash -x '{{.Path}}'",
            "script": "./scripts/chroot_{{user `script`}}.sh"
        },
        {
            "type": "file",
            "source": "/tmp/packages",
            "destination": "/usr/local/packer/logs/packages/{{user `region`}}-{{user `ami_name`}}",
            "direction": "download"
        }
    ],
    "builders": [
        {
            "type": "osc-ebssurrogate",
            "access_key": "{{user `ak`}}",
            "secret_key": "{{user `sk`}}",
            "region": "{{user `region`}}",
            "ssh_username": "centos",
            "instance_type": "c4.large",
            "source_ami": "{{user `omi`}}",
            "skip_region_validation": true,
	    "ssh_interface": "public_ip",
            "endpoints": {
                "ec2": "{{user `endpoint`}}"
            },
            "ami_virtualization_type": "hvm",
            "ami_name": "{{user `ami_name`}}",
	    "ami_users": ["{{user `qpats`}}"],
            "availability_zone": "{{user `region`}}a",
            "launch_block_device_mappings": [
                {
            	    "volume_type": "standard",
            	    "device_name": "/dev/xvdf",
            	    "delete_on_termination": true,
            	    "volume_size": "{{user `volume_size`}}"
                }
            ],
            "ami_root_device": {
                "delete_on_termination": true,
                "source_device_name": "/dev/xvdf",
                "device_name": "/dev/sda1",
                "volume_size": "{{user `volume_size`}}",
                "volume_type": "standard"
            }
        }
    ],
    "variables": {
        "ami_name": "{{env `AMI_NAME`}}",
	"region": "{{env `REGION`}}",
	"ak": "{{env `OSC_ACCESS_KEY`}}",
	"sk": "{{env `OSC_SECRET_KEY`}}",
	"script": "{{env `SCRIPT_BASE`}}",
	"omi": "{{env `SOURCE_OMI`}}",
	"endpoint": "{{env `ENDPOINT`}}",
	"qpats": "{{env `QPATS`}}",
	"volume_size": "{{env `VOL_SIZE`}}"
    }
}
