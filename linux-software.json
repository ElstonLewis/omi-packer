{
    "provisioners": [
        {
            "type": "shell",
            "execute_command": "chmod +x {{.Path}}; {{.Vars}} sudo -E -S bash -x '{{.Path}}'",
            "script": "./scripts/install-{{user `software`}}.sh",
            "environment_vars": ["ENV1={{user `env1`}}", "ENV2={{user `env2`}}", "ENV3={{user `env3`}}"]
        },
	{
            "type": "shell",
            "execute_command": "chmod +x {{.Path}}; {{.Vars}} sudo -E -S bash -x '{{.Path}}'",
            "script": "./scripts/cleanup.sh"
        },
        {
            "type": "file",
            "source": "/tmp/packages",
            "destination": "/usr/local/packer/logs/packages/{{user `region`}}-{{user `ami_name`}}",
            "direction": "download"
        }
    ],
    "builders": [
        {
            "type": "osc-ebs",
            "access_key": "{{user `ak`}}",
            "secret_key": "{{user `sk`}}",
            "region": "{{user `region`}}",
            "ssh_username": "outscale",
            "instance_type": "tinav4.c2r4p1",
            "source_ami": "{{user `omi`}}",
            "skip_region_validation": true,
	    "ssh_interface": "public_ip",
            "endpoints": {
                "ec2": "{{user `endpoint`}}"
            },
            "ami_virtualization_type": "hvm",
            "ami_name": "{{user `ami_name`}}",
	    "ami_users": ["{{user `qpats`}}"],
            "ami_product_codes": ["0001", "{{user `pcode`}}"],
            "availability_zone": "{{user `region`}}a"
        }
    ],
    "variables": {
        "ami_name": "{{env `AMI_NAME`}}",
	"region": "{{env `REGION`}}",
	"ak": "{{env `OSC_ACCESS_KEY`}}",
	"sk": "{{env `OSC_SECRET_KEY`}}",
	"env1": "{{env `ENV1`}}",
        "env2": "{{env `ENV2`}}",
        "env3": "{{env `ENV3`}}",
	"omi": "{{env `SOURCE_OMI`}}",
	"endpoint": "{{env `ENDPOINT`}}",
	"qpats": "{{env `QPATS`}}",
	"software": "{{env `SOFTWARE`}}",
	"pcode": "{{env `PRODUCT_CODE` }}"
    }
}
