{
    "provisioners": [
        {
            "type": "windows-update"
        },
        {
            "type": "powershell",
            "inline": [
                "Remove-Item -Recurse -Force C:\\Windows\\Outscale\\"
            ]
        },
        {
            "type": "file",
            "source": "files/windows/",
            "destination": "C:\\Windows\\Outscale\\"
        },
        {
            "type": "powershell",
            "scripts": [
                "scripts/windows/sysprep.ps1"
            ]
        }
    ],
    "builders": [
        {
            "type" : "osc-bsu",
            "access_key": "{{user `ak`}}",
            "secret_key": "{{user `sk`}}",
            "region": "{{user `region`}}",
            "source_omi": "{{user `omi`}}",
            "vm_type" : "tinav4.c4r4p1",
            "omi_name": "{{user `ami_name`}}",
            "user_data_file": "scripts/windows/userdata",
            "disable_stop_vm": true,
            "communicator": "winrm",
            "winrm_use_ssl": true,
            "winrm_insecure": true,
            "winrm_username": "Administrator",
            "skip_region_validation": true,
	        "ssh_interface": "public_ip"
        }
    ],
    "variables": {
        "ami_name": "{{env `AMI_NAME`}}",
        "region": "{{env `REGION`}}",
        "ak": "{{env `OSC_ACCESS_KEY`}}",
        "sk": "{{env `OSC_SECRET_KEY`}}",
        "omi": "{{env `SOURCE_OMI`}}"
    }
}
